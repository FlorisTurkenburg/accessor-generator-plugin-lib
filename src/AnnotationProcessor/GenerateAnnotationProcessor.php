<?php
namespace Hostnet\Component\AccessorGenerator\AnnotationProcessor;

use Hostnet\Component\AccessorGenerator\Annotation\Generate;

/**
 * Process the @Generate annotation and fill in which methods
 * should be generated by the code generator. Store everything
 * in a PropertyInformation object.
 *
 * @author Hidde Boomsma <hboomsma@hostnet.nl>
 */
class GenerateAnnotationProcessor implements AnnotationProcessorInterface
{
    /**
     * @see \Hostnet\Component\AccessorGenerator\AnnotationProcessorInterface::processAnnotation()
     * @param object $annotation
     * @param PropertyInformation $info
     */
    public function processAnnotation($annotation, PropertyInformation $info)
    {
        // Only process Generate annotations.
        if (!$annotation instanceof Generate) {
            return;
        }

        // By default no method is generated.
        //
        // Each processor can enforce a limitation on the generated methods.
        // If processor A lets a method be private, and processor B tells it to
        // be protected, it will end up private.

        $info->limitMaximumGetVisibility(
            Generate::getMostLimitedVisibility($annotation->getGet(), $annotation->getIs())
        );
        $info->limitMaximumSetVisibility(
            Generate::getMostLimitedVisibility($annotation->getSet())
        );
        $info->limitMaximumAddVisibility(
            Generate::getMostLimitedVisibility($annotation->getAdd(), $annotation->getSet())
        );
        $info->limitMaximumRemoveVisibility(
            Generate::getMostLimitedVisibility($annotation->getRemove(), $annotation->getSet())
        );

        $info->getType() === null && $annotation->getType() && $info->setType($annotation->getType());

        // Enforce always
        $info->setGenerateStrict($annotation->isStrict());
        null !== $annotation->getType() && $info->setTypeHint($annotation->getType());
    }

    /**
     * @see AnnotationProcessorInterface::getProcessableAnnotations()
     */
    public function getProcessableAnnotationNamespace()
    {
        return 'Hostnet\Component\AccessorGenerator\Annotation';
    }
}
